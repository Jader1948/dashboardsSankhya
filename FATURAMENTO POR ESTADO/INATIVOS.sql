
SELECT COUNT(B.COD_CLIENTE) QTD_INATIVOS FROM(

SELECT  A.UF,
	A.CODPARC AS COD_CLIENTE,
	A.NOME_CLIENTE AS CLIENTE,
	A.APELIDO AS REPRESENTANTE,
	A.NUNOTA,
	A.DT_COMPRA
FROM( 
SELECT CAB.CODPARC,
	UF.UF,
	PAR.RAZAOSOCIAL AS NOME_CLIENTE,
	CAB.NUNOTA,
	CAB.CODVEND,
	VEN.APELIDO,
	MAX(DTNEG)AS DT_COMPRA
FROM TGFPAR PAR
	INNER JOIN TGFCAB CAB ON CAB.CODPARC = PAR.CODPARC
	INNER JOIN TGFVEN VEN ON VEN.CODVEND = CAB.CODVEND
	INNER JOIN TSICID CID ON CID.CODCID = PAR.CODCID
	INNER JOIN TSIUFS UF ON UF.CODUF = CID.UF
WHERE 
CAB.TIPMOV = 'V'
AND CAB.STATUSNOTA = 'L'
AND CAB.CODEMP IN (1,2,3)
AND CAB.CODNAT IN (1010100,1010300,1010300)
--AND CAB.CODVEND IN :REPRESENTANTE
AND CAB.CODTIPOPER IN (1100,1101,1102,1103,1105,1111,1219,1231,1237,1241,1242,1247,1258,1260,1277,1291,1316,1319,1348,1350)
AND PAR.ATIVO = 'S'
AND CAB.DTNEG < DATEADD(YEAR,-1, '2023/06/01') AND CAB.CODPARC NOT IN(SELECT CODPARC FROM TGFCAB CAB WHERE CAB.DTNEG BETWEEN DATEADD(YEAR,-1, '2023/06/01') AND '2023/06/30')
GROUP BY CAB.CODPARC, PAR.RAZAOSOCIAL,CAB.DTNEG,CAB.CODVEND, VEN.APELIDO, UF.UF,CAB.NUNOTA

)A


)B