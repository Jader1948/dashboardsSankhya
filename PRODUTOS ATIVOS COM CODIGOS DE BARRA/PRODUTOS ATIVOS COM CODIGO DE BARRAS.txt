SELECT PRO.REFERENCIA as Referencia,
	PRO.DESCRPROD as Produto,
	COALESCE((SELECT DESCRPROD FROM TGFPRO PRO WHERE PRO.CODPROD = ICP.CODMATPRIMA),'SEM_ESTOJO') AS ESTOJO,
	COALESCE(SUBSTRING (BAR.CODBARRA,7,LEN(BAR.CODBARRA)),'SEM EAN') as EAN,
	COALESCE(PRO.AD_COR,'SEM COR') as Cor,
	COALESCE((EST.ESTOQUE - EST.RESERVADO),0) AS Estoque,
	COALESCE(EST.CODLOCAL,0) as Local,
	COALESCE(LOC.DESCRLOCAL, 'SEM LOCAL') as Descricao,
	PRO.ATIVO as Ativo
FROM TGFPRO PRO 
	LEFT JOIN TGFEST EST ON EST.CODPROD = PRO.CODPROD
	LEFT JOIN TGFLOC LOC ON LOC.CODLOCAL = EST.CODLOCAL
	LEFT JOIN TGFBAR BAR ON BAR.CODPROD = PRO.CODPROD
	LEFT JOIN TGFICP ICP ON ICP.CODPROD = PRO.CODPROD
WHERE PRO.ATIVO= 'S' AND
PRO.REFERENCIA NOT LIKE '%362%' AND 
PRO.REFERENCIA NOT LIKE'%363%' AND
PRO.REFERENCIA NOT LIKE '%364%' AND
PRO.REFERENCIA NOT LIKE '%365%' AND
PRO.REFERENCIA NOT LIKE '%C14%' AND
PRO.REFERENCIA NOT LIKE '%ALGO%' AND
PRO.REFERENCIA NOT LIKE '%BOBINA%' AND
PRO.REFERENCIA NOT LIKE '%COTONETE%'
ORDER BY PRO.REFERENCIA
